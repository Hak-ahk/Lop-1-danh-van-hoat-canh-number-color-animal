<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game T·∫≠p G√µ Ch·ªØ: V5</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1a1a2e;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            flex-direction: column;
            text-align: center;
        }

        .game-container {
            position: relative;
            width: 90%;
            max-width: 800px;
            height: 600px;
            border: 5px solid #00bfff;
            background-color: #2e2e4a;
            box-shadow: 0 0 20px rgba(0, 191, 255, 0.5);
            overflow: hidden;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            max-height: 80vh;
            margin-top: 20px;
        }

        .falling-char {
            position: absolute;
            font-size: 3em;
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
            user-select: none;
            cursor: pointer;
            width: 50px;
            height: 50px;
            line-height: 50px;
            border-radius: 50%;
            background-color: rgba(255, 204, 0, 0.2);
            transition: background-color 0.1s ease-out;
            text-transform: uppercase;
        }
        
        .falling-char.correct {
            animation: pulse 0.5s ease-in-out;
            color: #32cd32;
        }

        .correct-char-display {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5em;
            color: #32cd32;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
            letter-spacing: 5px;
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
        }
        
        .word-info {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0.8;
            transition: opacity 0.5s ease-in-out;
        }

        .word-info .emoji {
            font-size: 5em;
            margin-bottom: 10px;
        }

        .word-info .vietnamese {
            font-size: 1.5em;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 800px;
            margin-top: 20px;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 20px;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-start {
            background-image: linear-gradient(to right, #00bfff, #0073e6);
            color: white;
        }

        .btn-reset {
            background-image: linear-gradient(to right, #ff416c, #ff4b2b);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        #score-display {
            font-size: 2em;
            font-weight: bold;
            color: #f7b731;
            margin-top: 20px;
        }
        
        #progress-display {
            font-size: 1.5em;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        .main-menu {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }

        .firework {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #fff;
            border-radius: 50%;
            opacity: 0;
            animation: firework-burst 1s forwards;
            z-index: 100;
        }
        
        #end-game-message {
            font-size: 2.5em;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
            animation: bounce 2s infinite;
        }

        @keyframes firework-burst {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(2.5);
                opacity: 0;
            }
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }

        /* Th√™m c√°c ƒëi·ªÅu ch·ªânh cho c√°c thi·∫øt b·ªã nh·ªè h∆°n */
        @media (max-width: 768px) {
            .game-container {
                height: 50vh;
                max-width: 95%; 
            }
            .word-info .emoji {
                font-size: 3em;
            }
            .word-info .vietnamese {
                font-size: 1.2em;
            }
            .falling-char {
                font-size: 2em;
            }
            .correct-char-display {
                font-size: 1.5em;
            }
            .btn {
                padding: 10px 20px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <!-- Menu ch√≠nh s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã khi game kh√¥ng ch·∫°y -->
        <div id="main-menu" class="main-menu">
            <h1>Game G√µ T·ª´ V·ª±ng</h1>
            <p>Ch·∫°m v√†o c√°c ch·ªØ c√°i ƒë·ªÉ t·∫°o th√†nh t·ª´!</p>
            <p>B·∫•m B·∫Øt ƒë·∫ßu ƒë·ªÉ ch∆°i</p>
        </div>
        <!-- Th√¥ng b√°o k·∫øt th√∫c game -->
        <div id="end-game-message" style="display: none;">
            Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c√°c t·ª´!
        </div>
        
        <!-- Hi·ªÉn th·ªã emoji v√† nghƒ©a ti·∫øng Vi·ªát -->
        <div id="word-info" class="word-info">
            <span id="word-emoji" class="emoji"></span>
            <span id="word-vietnamese" class="vietnamese"></span>
        </div>
        
        <!-- Ch·ªØ r∆°i s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JS -->
        <div id="correct-char-display" class="correct-char-display"></div>
    </div>

    <div class="game-info">
        <h2 id="current-word">S·∫µn s√†ng!</h2>
        <h2 id="score-display">T·ª´ ho√†n th√†nh: 0</h2>
        <h2 id="progress-display">Ti·∫øn ƒë·ªô: 0 / 0</h2>
    </div>

    <div class="controls">
        <button id="start-btn" class="btn btn-start">B·∫Øt ƒë·∫ßu</button>
        <button id="reset-btn" class="btn btn-reset">Ch∆°i l·∫°i</button>
    </div>
    
    <script>
        // Danh s√°ch c√°c t·ª´ v·ª±ng v·ªõi nghƒ©a ti·∫øng Vi·ªát v√† emoji
        const wordCategories = {
            colors: [
                { english: "red", vietnamese: "m√†u ƒë·ªè", emoji: "üî¥" },
                { english: "blue", vietnamese: "m√†u xanh d∆∞∆°ng", emoji: "üîµ" },
                { english: "yellow", vietnamese: "m√†u v√†ng", emoji: "üü°" },
                { english: "green", vietnamese: "m√†u xanh l√°", emoji: "üü¢" },
                { english: "black", vietnamese: "m√†u ƒëen", emoji: "‚ö´" },
                { english: "white", vietnamese: "m√†u tr·∫Øng", emoji: "‚ö™" },
                { english: "pink", vietnamese: "m√†u h·ªìng", emoji: "ü©∑" },
                { english: "brown", vietnamese: "m√†u n√¢u", emoji: "üü§" },
                { english: "orange", vietnamese: "m√†u cam", emoji: "üü†" },
                { english: "purple", vietnamese: "m√†u t√≠m", emoji: "üü£" },
                { english: "grey", vietnamese: "m√†u x√°m", emoji: "üîò" },
                { english: "gray", vietnamese: "m√†u x√°m", emoji: "üîò" },
                { english: "light blue", vietnamese: "m√†u xanh da tr·ªùi", emoji: "üíô" },
                { english: "dark green", vietnamese: "m√†u xanh l√° ƒë·∫≠m", emoji: "üíö" }
            ],
            numbers: [
                { english: "one", vietnamese: "s·ªë m·ªôt", emoji: "1Ô∏è‚É£" },
                { english: "two", vietnamese: "s·ªë hai", emoji: "2Ô∏è‚É£" },
                { english: "three", vietnamese: "s·ªë ba", emoji: "3Ô∏è‚É£" },
                { english: "four", vietnamese: "s·ªë b·ªën", emoji: "4Ô∏è‚É£" },
                { english: "five", vietnamese: "s·ªë nƒÉm", emoji: "5Ô∏è‚É£" },
                { english: "six", vietnamese: "s·ªë s√°u", emoji: "6Ô∏è‚É£" },
                { english: "seven", vietnamese: "s·ªë b·∫£y", emoji: "7Ô∏è‚É£" },
                { english: "eight", vietnamese: "s·ªë t√°m", emoji: "8Ô∏è‚É£" },
                { english: "nine", vietnamese: "s·ªë ch√≠n", emoji: "9Ô∏è‚É£" },
                { english: "ten", vietnamese: "s·ªë m∆∞·ªùi", emoji: "üîü" },
                { english: "eleven", vietnamese: "s·ªë m∆∞·ªùi m·ªôt", emoji: "üî¢" },
                { english: "twelve", vietnamese: "s·ªë m∆∞·ªùi hai", emoji: "üî¢" },
                { english: "thirteen", vietnamese: "s·ªë m∆∞·ªùi ba", emoji: "üî¢" },
                { english: "fourteen", vietnamese: "s·ªë m∆∞·ªùi b·ªën", emoji: "üî¢" },
                { english: "fifteen", vietnamese: "s·ªë m∆∞·ªùi lƒÉm", emoji: "üî¢" },
                { english: "sixteen", vietnamese: "s·ªë m∆∞·ªùi s√°u", emoji: "üî¢" },
                { english: "seventeen", vietnamese: "s·ªë m∆∞·ªùi b·∫£y", emoji: "üî¢" },
                { english: "eighteen", vietnamese: "s·ªë m∆∞·ªùi t√°m", emoji: "üî¢" },
                { english: "nineteen", vietnamese: "s·ªë m∆∞·ªùi ch√≠n", emoji: "üî¢" },
                { english: "twenty", vietnamese: "s·ªë hai m∆∞∆°i", emoji: "üî¢" }
            ],
            animals: [
                { english: "dog", vietnamese: "con ch√≥", emoji: "üê∂" },
                { english: "cat", vietnamese: "con m√®o", emoji: "üê±" },
                { english: "bird", vietnamese: "con chim", emoji: "üê¶" },
                { english: "fish", vietnamese: "con c√°", emoji: "üêü" },
                { english: "duck", vietnamese: "con v·ªãt", emoji: "ü¶Ü" },
                { english: "chicken", vietnamese: "con g√†", emoji: "üêî" },
                { english: "cow", vietnamese: "con b√≤", emoji: "üêÆ" },
                { english: "pig", vietnamese: "con l·ª£n", emoji: "üê∑" },
                { english: "horse", vietnamese: "con ng·ª±a", emoji: "üê¥" },
                { english: "sheep", vietnamese: "con c·ª´u", emoji: "üêë" },
                { english: "lion", vietnamese: "con s∆∞ t·ª≠", emoji: "ü¶Å" },
                { english: "tiger", vietnamese: "con h·ªï", emoji: "üêØ" },
                { english: "elephant", vietnamese: "con voi", emoji: "üêò" },
                { english: "monkey", vietnamese: "con kh·ªâ", emoji: "üêµ" },
                { english: "bear", vietnamese: "con g·∫•u", emoji: "üêª" }
            ],
            schoolSupplies: [
                { english: "book", vietnamese: "s√°ch", emoji: "üìö" },
                { english: "pen", vietnamese: "b√∫t m·ª±c", emoji: "üñãÔ∏è" },
                { english: "pencil", vietnamese: "b√∫t ch√¨", emoji: "‚úèÔ∏è" },
                { english: "eraser", vietnamese: "c·ª•c t·∫©y", emoji: "üßº" },
                { english: "ruler", vietnamese: "th∆∞·ªõc k·∫ª", emoji: "üìè" },
                { english: "bag", vietnamese: "t√∫i x√°ch", emoji: "üëú" },
                { english: "schoolbag", vietnamese: "c·∫∑p s√°ch", emoji: "üéí" },
                { english: "notebook", vietnamese: "s·ªï tay", emoji: "üìì" },
                { english: "sharpener", vietnamese: "g·ªçt b√∫t ch√¨", emoji: "üî™" },
                { english: "board", vietnamese: "b·∫£ng", emoji: "Ïπ†Ìåê" },
                { english: "chalk", vietnamese: "ph·∫•n", emoji: "üìù" },
                { english: "desk", vietnamese: "b√†n h·ªçc", emoji: "ü™ë" },
                { english: "chair", vietnamese: "gh·∫ø", emoji: "ü™ë" },
                { english: "crayon", vietnamese: "b√∫t s√°p", emoji: "üñçÔ∏è" },
                { english: "glue", vietnamese: "keo d√°n", emoji: "üß¥" },
                { english: "scissors", vietnamese: "k√©o", emoji: "‚úÇÔ∏è" }
            ]
        };

        const allWords = [].concat(
            wordCategories.colors,
            wordCategories.numbers,
            wordCategories.animals,
            wordCategories.schoolSupplies
        );
        
        // L·∫•y c√°c ph·∫ßn t·ª≠ DOM c·∫ßn thi·∫øt
        const gameContainer = document.querySelector('.game-container');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const scoreDisplay = document.getElementById('score-display');
        const progressDisplay = document.getElementById('progress-display');
        const currentWordDisplay = document.getElementById('current-word');
        const correctCharDisplay = document.getElementById('correct-char-display');
        const mainMenu = document.getElementById('main-menu');
        const endGameMessage = document.getElementById('end-game-message');
        const wordInfo = document.getElementById('word-info');
        const wordEmoji = document.getElementById('word-emoji');
        const wordVietnamese = document.getElementById('word-vietnamese');
        
        // C√°c bi·∫øn tr·∫°ng th√°i c·ªßa game
        let currentWordChars = [];
        let wordIndex = 0;
        let score = 0;
        let fallingChars = [];
        let isGameRunning = false;
        let fireworkCount = 0;
        let animationFrames = [];
        let currentWordDataIndex = 0;
        let nextWordTimeoutId = null;
        let spellingTimeoutId = null;

        /**
         * H√†m x√°o tr·ªôn m·∫£ng ng·∫´u nhi√™n (Fisher-Yates shuffle)
         * @param {Array} array - M·∫£ng c·∫ßn x√°o tr·ªôn.
         */
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }
            return array;
        }
        
        /**
         * T·∫°o m·ªôt ch·ªØ c√°i r∆°i t·ª´ tr√™n xu·ªëng, di chuy·ªÉn ngang theo th·ª© t·ª±.
         * @param {string} char - K√Ω t·ª± s·∫Ω ƒë∆∞·ª£c t·∫°o.
         */
        function createFallingChar(char) {
            const charElement = document.createElement('div');
            charElement.classList.add('falling-char');
            charElement.textContent = char;
            
            // ƒê·∫∑t v·ªã tr√≠ ng·∫´u nhi√™n tr√™n m√†n h√¨nh
            const randomX = Math.random() * (gameContainer.offsetWidth - 50);
            const randomY = Math.random() * (gameContainer.offsetHeight - 50);
            
            charElement.style.left = `${randomX}px`;
            charElement.style.top = `${randomY}px`;
            
            charElement.addEventListener('click', () => handleKeyPress({ key: char }));
            
            gameContainer.appendChild(charElement);
            fallingChars.push({ element: charElement, char: char });
            
            // Th√™m hi·ªáu ·ª©ng di chuy·ªÉn ng·∫´u nhi√™n
            animateRandomMovement(charElement);
        }

        /**
         * H√†m t·∫°o hi·ªáu ·ª©ng di chuy·ªÉn ng·∫´u nhi√™n cho ch·ªØ c√°i.
         * @param {HTMLElement} element - Ph·∫ßn t·ª≠ ch·ªØ c√°i c·∫ßn di chuy·ªÉn.
         */
        function animateRandomMovement(element) {
            if (!isGameRunning) {
                return;
            }

            const duration = 2000 + Math.random() * 3000;
            const newX = Math.random() * (gameContainer.offsetWidth - 50);
            const newY = Math.random() * (gameContainer.offsetHeight - 50);

            element.style.transition = `top ${duration}ms ease-in-out, left ${duration}ms ease-in-out`;
            element.style.left = `${newX}px`;
            element.style.top = `${newY}px`;

            setTimeout(() => {
                animateRandomMovement(element);
            }, duration);
        }

        /**
         * S·ª≠ d·ª•ng Web Speech API ƒë·ªÉ ƒë·ªçc t·ª´.
         * @param {string} text - VƒÉn b·∫£n c·∫ßn ƒë·ªçc.
         */
        function playWordAudio(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            speechSynthesis.speak(utterance);
        }
        
        /**
         * ƒê√°nh v·∫ßn t·ª´ng ch·ªØ c√°i c·ªßa t·ª´.
         * @param {string} word - T·ª´ c·∫ßn ƒë√°nh v·∫ßn.
         * @param {function} callback - H√†m callback ƒë∆∞·ª£c g·ªçi sau khi ƒë√°nh v·∫ßn xong.
         */
        function spellWord(word, callback) {
            const letters = word.split('');
            let delay = 0;
            const lettersToSpell = letters.filter(char => char !== ' ');
            
            lettersToSpell.forEach((letter, index) => {
                spellingTimeoutId = setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance(letter);
                    utterance.lang = 'en-US';
                    speechSynthesis.speak(utterance);
                    if (index === lettersToSpell.length - 1) {
                        if (callback) {
                            callback();
                        }
                    }
                }, delay);
                delay += 500; // Th·ªùi gian ch·ªù gi·ªØa c√°c ch·ªØ c√°i
            });

            if (lettersToSpell.length === 0 && callback) {
                callback();
            }
        }

        /**
         * B·∫Øt ƒë·∫ßu tr√≤ ch∆°i.
         */
        function startGame() {
            if (isGameRunning) return;
            isGameRunning = true;
            mainMenu.style.display = 'none';
            endGameMessage.style.display = 'none';
            score = 0;
            currentWordDataIndex = 0;
            updateScoreDisplay();
            startNewWord();
            startBtn.style.display = 'none';
            resetBtn.style.display = 'block';
        }

        /**
         * B·∫Øt ƒë·∫ßu m·ªôt t·ª´ m·ªõi.
         */
        function startNewWord() {
            if (!isGameRunning) {
                return;
            }
            
            wordIndex = 0;
            
            if (currentWordDataIndex >= allWords.length) {
                endGame();
                return;
            }
            
            const currentWordData = allWords[currentWordDataIndex];
            currentWordChars = currentWordData.english.toUpperCase().split('');
            const charsToCreate = currentWordChars.filter(char => char !== ' ');

            currentWordDisplay.textContent = currentWordData.english;
            wordEmoji.textContent = currentWordData.emoji;
            wordVietnamese.textContent = currentWordData.vietnamese;
            wordInfo.style.opacity = 1;

            correctCharDisplay.textContent = '';
            
            cancelAnimations();
            gameContainer.querySelectorAll('.falling-char').forEach(char => char.remove());
            fallingChars = [];

            // ƒê·ªçc t·ª´ v√† ƒë√°nh v·∫ßn khi b·∫Øt ƒë·∫ßu
            playWordAudio(currentWordData.english);

            setTimeout(() => {
                spellWord(currentWordData.english, () => {
                    charsToCreate.forEach(char => {
                        createFallingChar(char);
                    });
                });
            }, 2000); // ƒê·ª£i 2 gi√¢y sau khi ƒë·ªçc t·ª´ xong m·ªõi b·∫Øt ƒë·∫ßu ƒë√°nh v·∫ßn
            
            updateProgressDisplay();
        }

        /**
         * X·ª≠ l√Ω s·ª± ki·ªán khi ng∆∞·ªùi ch∆°i b·∫•m ph√≠m ho·∫∑c ch·∫°m v√†o ch·ªØ c√°i.
         * @param {object} e - S·ª± ki·ªán.
         */
        function handleKeyPress(e) {
            if (!isGameRunning || wordIndex >= currentWordChars.length) {
                return;
            }

            while (currentWordChars[wordIndex] === ' ' && wordIndex < currentWordChars.length) {
                correctCharDisplay.textContent += ' ';
                wordIndex++;
            }

            if (wordIndex >= currentWordChars.length) {
                completeWord();
                return;
            }

            const keyPressed = e.key.toUpperCase();
            const targetChar = currentWordChars[wordIndex].toUpperCase();

            if (keyPressed === targetChar) {
                const charToFind = fallingChars.find(c => c.char.toUpperCase() === targetChar);
                
                if (charToFind) {
                    charToFind.element.remove();
                    fallingChars = fallingChars.filter(c => c !== charToFind);
                    
                    playWordAudio(targetChar); // ƒê·ªçc k√Ω t·ª± v·ª´a g√µ ƒë√∫ng

                    correctCharDisplay.textContent += currentWordChars[wordIndex];
                    wordIndex++;
                    
                    while (currentWordChars[wordIndex] === ' ' && wordIndex < currentWordChars.length) {
                        correctCharDisplay.textContent += ' ';
                        wordIndex++;
                    }

                    if (wordIndex >= currentWordChars.length) {
                        completeWord();
                    }
                }
            }
        }

        /**
         * X·ª≠ l√Ω khi ng∆∞·ªùi ch∆°i ho√†n th√†nh m·ªôt t·ª´.
         */
        function completeWord() {
            score++;
            currentWordDataIndex++;
            updateScoreDisplay();
            
            isGameRunning = false;
            
            const currentWordData = allWords[currentWordDataIndex - 1]; // L·∫•y t·ª´ v·ª´a ho√†n th√†nh
            playWordAudio(currentWordData.english); // ƒê·ªçc l·∫°i t·ª´ ƒë√≥

            nextWordTimeoutId = setTimeout(() => {
                isGameRunning = true;
                startNewWord();
            }, 4000);
        }
        
        /**
         * X·ª≠ l√Ω khi ng∆∞·ªùi ch∆°i ho√†n th√†nh t·∫•t c·∫£ c√°c t·ª´.
         */
        function endGame() {
            isGameRunning = false;
            currentWordDisplay.textContent = 'Tr√≤ ch∆°i k·∫øt th√∫c!';
            correctCharDisplay.textContent = '';
            wordInfo.style.opacity = 0;
            playFireworks();
            endGameMessage.style.display = 'block';
        }

        /**
         * C·∫≠p nh·∫≠t s·ªë t·ª´ ho√†n th√†nh tr√™n m√†n h√¨nh.
         */
        function updateScoreDisplay() {
            scoreDisplay.textContent = `T·ª´ ho√†n th√†nh: ${score}`;
            updateProgressDisplay();
        }
        
        /**
         * C·∫≠p nh·∫≠t ti·∫øn ƒë·ªô tr√™n m√†n h√¨nh.
         */
        function updateProgressDisplay() {
            progressDisplay.textContent = `Ti·∫øn ƒë·ªô: ${currentWordDataIndex} / ${allWords.length}`;
        }
        
        /**
         * B·∫Øt ƒë·∫ßu hi·ªáu ·ª©ng ph√°o hoa.
         */
        function playFireworks() {
            fireworkCount = 0;
            triggerFireworkBurst();
        }

        /**
         * K√≠ch ho·∫°t m·ªôt ƒë·ª£t ph√°o hoa.
         */
        function triggerFireworkBurst() {
            if (fireworkCount >= 3) return;
            fireworkCount++;
            for (let i = 0; i < 50; i++) {
                createFirework();
            }
            setTimeout(triggerFireworkBurst, 1000);
        }

        /**
         * T·∫°o m·ªôt h·∫°t ph√°o hoa ƒë∆°n l·∫ª.
         */
        function createFirework() {
            const firework = document.createElement('div');
            firework.classList.add('firework');
            const x = Math.random() * gameContainer.offsetWidth;
            const y = Math.random() * gameContainer.offsetHeight;
            firework.style.left = `${x}px`;
            firework.style.top = `${y}px`;
            gameContainer.appendChild(firework);

            const size = Math.random() * 10 + 5;
            firework.style.width = `${size}px`;
            firework.style.height = `${size}px`;
            firework.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
            
            firework.animate([
                { transform: 'scale(0)', opacity: 1 },
                { transform: 'scale(1.5)', opacity: 0 }
            ], {
                duration: 1000,
                easing: 'ease-out'
            }).onfinish = () => firework.remove();
        }

        /**
         * H·ªßy t·∫•t c·∫£ c√°c animation frame ƒëang ch·∫°y
         */
        function cancelAnimations() {
            animationFrames.forEach(frame => cancelAnimationFrame(frame));
            animationFrames = [];
        }

        /**
         * ƒê·∫∑t l·∫°i tr√≤ ch∆°i v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu.
         */
        function resetGame() {
            isGameRunning = false;
            score = 0;
            updateScoreDisplay();
            currentWordDataIndex = 0; // ƒê·∫∑t l·∫°i ch·ªâ s·ªë t·ª´ v·ª±ng
            updateProgressDisplay();
            currentWordDisplay.textContent = 'S·∫µn s√†ng!';
            correctCharDisplay.textContent = '';
            wordInfo.style.opacity = 0;
            
            // D·ª´ng t·∫•t c·∫£ c√°c ho·∫°t ƒë·ªông √¢m thanh v√† ho·∫°t ·∫£nh
            if (nextWordTimeoutId) {
                clearTimeout(nextWordTimeoutId);
            }
            if (spellingTimeoutId) {
                clearTimeout(spellingTimeoutId);
            }
            speechSynthesis.cancel();
            
            mainMenu.style.display = 'flex';
            endGameMessage.style.display = 'none';
            startBtn.style.display = 'block';
            resetBtn.style.display = 'none';
            
            cancelAnimations();
            gameContainer.querySelectorAll('.falling-char').forEach(char => char.remove());
            fallingChars = [];
            
            document.querySelectorAll('.firework').forEach(fw => fw.remove());
        }
        
        // G·∫Øn s·ª± ki·ªán click cho c√°c n√∫t
        startBtn.addEventListener('click', startGame);
        resetBtn.addEventListener('click', resetGame);

        // Kh·ªüi t·∫°o game khi load trang
        resetGame();

        // C·∫≠p nh·∫≠t k√≠ch th∆∞·ªõc game khi c·ª≠a s·ªï thay ƒë·ªïi
        window.addEventListener('resize', () => {
            const containerWidth = window.innerWidth * 0.9;
            const containerHeight = Math.min(600, window.innerHeight * 0.8);
            gameContainer.style.width = `${containerWidth}px`;
            gameContainer.style.height = `${containerHeight}px`;
        });
    </script>
</body>
</html>
